statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
#vectors = c("v41690973")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df$object.vectorDataPoint[[1]][c("refPer","value")]
names(df)[1] <- "Date"
names(df)[2] <- "Value"
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
library(httr)
library(jsonlite)
library(dplyr)
library(purrr)
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
#vectors = c("v41690973")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df$object.vectorDataPoint[[1]][c("refPer","value")]
names(df)[1] <- "Date"
names(df)[2] <- "Value"
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
#vectors = c("v41690973")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
names(df)[1] <- "Date"
names(df)[2] <- "Value"
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
names(df)[1] <- "Date"
names(df)[2] <- "Value"
}
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]]
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
plot(df)
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
plot(df)
View(df)
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
names(df)[1] <- "Date"
names(df)[2] <- "Value"
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
df <- statcan_daterange("v1", "2015-01-01", "2021-02-18")
df
names(df)[1] <- "Date"
names(df)[2] <- "Value"
df
#df <- statcan_daterange("v1", "2015-01-01", "2021-02-18")
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
names(df)[1] <- "Date"
names(df)[2] <- "Value"
}
df <- statcan_daterange("v1", "2015-01-01", "2021-02-18")
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df <- statcan_daterange("v1", "2015-01-01", "2021-02-18")
df
df[1]
dateTime(df[1])
as.date(df[1])
as.Date(df[1])
format(as.Date(df[1]))
as.POSIXct(df[1],format="%m/%d/%Y %H:%M:%S",tz=Sys.timezone())
format(as.Date(df$refPer))
as.Date(df$refPer)
df$refPer <- as.Date(df$refPer)
View(df)
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
df$refPer <- as.Date(df$refPer)
}
df <- statcan_daterange("v1", "2015-01-01", "2021-02-18")
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df <- statcan_daterange("v1", "2015-01-01", "2021-02-18")
df
as.POSIXct(df$refPer,format="%Y-%m-%dT%H:%M:%OS")
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df <- statcan_daterange("v1", "2015-01-01", "2021-02-18")
as.POSIXct(df$refPer,format="%Y-%m-%dT%H:%M:%OS")
df <- statcan_daterange("v1", "2018-01-01", "2021-02-18")
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
df <- statcan_daterange("v1", "2018-01-01", "2021-02-18")
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
library(ggplot2)
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df
ggplot(df, aes(x=refPer, y=value)) +
geom_line() +
xlab("")
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
df$refPer <- as.Date(df$refPer)
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
df$refPer <- as.Date(df$refPer)
}
library(ggplot2)
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
df
statcan_daterange<-function(vectors, start_time, end_time=Sys.time(), use_ref_date=TRUE){
url = "https://www150.statcan.gc.ca/t1/wds/rest/getBulkVectorDataByRange"
start_date = paste0(start_time,"T00:00")
end_date = paste0(end_time,"T00:00")
vectors=gsub("^v","",vectors)
vectors_string=paste0('"vectorIds":[',paste(map(as.character(vectors),function(x)paste0('"',x,'"')),collapse = ", "),"]")
time_string=paste0('"startDataPointReleaseDate": "',start_date,
'","endDataPointReleaseDate": "',end_date,'"')
body=paste0("{",vectors_string,",",time_string,"}")
r <- POST(url, body=body, encode = "json", timeout(200), add_headers("Content-Type"="application/json"))
result <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(result, flatten = TRUE)
df <- df$object.vectorDataPoint[[1]][c("refPer","value")]
}
library(ggplot2)
df <- statcan_daterange("v1", "2019-01-01", "2021-02-18")
df$refPer <- as.Date(df$refPer)
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
View(df)
df <- statcan_daterange("v1", "2010-01-01", "2021-02-18")
df$refPer <- as.Date(df$refPer)
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
View(df)
paste0("2021-02-18","T00:00")
df <- statcan_daterange("v1", start_time = "2015-01-01", end_time = "2021-02-18")
df$refPer <- as.Date(df$refPer)
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
df <- statcan_daterange("v1", start_time = "2015-01-01", end_time = "2021-02-18")
df$refPer <- as.Date(df$refPer)
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
df <- statcan_daterange("v1", start_time = "2019-01-01", end_time = "2021-02-18")
df$refPer <- as.Date(df$refPer)
ggplot(df, aes(x=refPer, y=value)) +
geom_line()
